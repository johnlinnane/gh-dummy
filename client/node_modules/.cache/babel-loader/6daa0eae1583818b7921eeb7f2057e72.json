{"ast":null,"code":"var objectAssign = require('object-assign');\n\nfunction arrayRemove(arr, item) {\n  var idx = arr.indexOf(item);\n  if (~idx) arr.splice(idx, 1);\n}\n\nfunction FileAppender(strategy, req) {\n  this.strategy = strategy;\n  this.req = req;\n\n  switch (strategy) {\n    case 'NONE':\n      break;\n\n    case 'VALUE':\n      break;\n\n    case 'ARRAY':\n      req.files = [];\n      break;\n\n    case 'OBJECT':\n      req.files = Object.create(null);\n      break;\n\n    default:\n      throw new Error('Unknown file strategy: ' + strategy);\n  }\n}\n\nFileAppender.prototype.insertPlaceholder = function (file) {\n  var placeholder = {\n    fieldname: file.fieldname\n  };\n\n  switch (this.strategy) {\n    case 'NONE':\n      break;\n\n    case 'VALUE':\n      break;\n\n    case 'ARRAY':\n      this.req.files.push(placeholder);\n      break;\n\n    case 'OBJECT':\n      if (this.req.files[file.fieldname]) {\n        this.req.files[file.fieldname].push(placeholder);\n      } else {\n        this.req.files[file.fieldname] = [placeholder];\n      }\n\n      break;\n  }\n\n  return placeholder;\n};\n\nFileAppender.prototype.removePlaceholder = function (placeholder) {\n  switch (this.strategy) {\n    case 'NONE':\n      break;\n\n    case 'VALUE':\n      break;\n\n    case 'ARRAY':\n      arrayRemove(this.req.files, placeholder);\n      break;\n\n    case 'OBJECT':\n      if (this.req.files[placeholder.fieldname].length === 1) {\n        delete this.req.files[placeholder.fieldname];\n      } else {\n        arrayRemove(this.req.files[placeholder.fieldname], placeholder);\n      }\n\n      break;\n  }\n};\n\nFileAppender.prototype.replacePlaceholder = function (placeholder, file) {\n  if (this.strategy === 'VALUE') {\n    this.req.file = file;\n    return;\n  }\n\n  delete placeholder.fieldname;\n  objectAssign(placeholder, file);\n};\n\nmodule.exports = FileAppender;","map":{"version":3,"sources":["/Users/johnlinnane/DEV/traveller-collection/client/node_modules/multer/lib/file-appender.js"],"names":["objectAssign","require","arrayRemove","arr","item","idx","indexOf","splice","FileAppender","strategy","req","files","Object","create","Error","prototype","insertPlaceholder","file","placeholder","fieldname","push","removePlaceholder","length","replacePlaceholder","module","exports"],"mappings":"AAAA,IAAIA,YAAY,GAAGC,OAAO,CAAC,eAAD,CAA1B;;AAEA,SAASC,WAAT,CAAsBC,GAAtB,EAA2BC,IAA3B,EAAiC;AAC/B,MAAIC,GAAG,GAAGF,GAAG,CAACG,OAAJ,CAAYF,IAAZ,CAAV;AACA,MAAI,CAACC,GAAL,EAAUF,GAAG,CAACI,MAAJ,CAAWF,GAAX,EAAgB,CAAhB;AACX;;AAED,SAASG,YAAT,CAAuBC,QAAvB,EAAiCC,GAAjC,EAAsC;AACpC,OAAKD,QAAL,GAAgBA,QAAhB;AACA,OAAKC,GAAL,GAAWA,GAAX;;AAEA,UAAQD,QAAR;AACE,SAAK,MAAL;AAAa;;AACb,SAAK,OAAL;AAAc;;AACd,SAAK,OAAL;AAAcC,MAAAA,GAAG,CAACC,KAAJ,GAAY,EAAZ;AAAgB;;AAC9B,SAAK,QAAL;AAAeD,MAAAA,GAAG,CAACC,KAAJ,GAAYC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAZ;AAAiC;;AAChD;AAAS,YAAM,IAAIC,KAAJ,CAAU,4BAA4BL,QAAtC,CAAN;AALX;AAOD;;AAEDD,YAAY,CAACO,SAAb,CAAuBC,iBAAvB,GAA2C,UAAUC,IAAV,EAAgB;AACzD,MAAIC,WAAW,GAAG;AAChBC,IAAAA,SAAS,EAAEF,IAAI,CAACE;AADA,GAAlB;;AAIA,UAAQ,KAAKV,QAAb;AACE,SAAK,MAAL;AAAa;;AACb,SAAK,OAAL;AAAc;;AACd,SAAK,OAAL;AAAc,WAAKC,GAAL,CAASC,KAAT,CAAeS,IAAf,CAAoBF,WAApB;AAAkC;;AAChD,SAAK,QAAL;AACE,UAAI,KAAKR,GAAL,CAASC,KAAT,CAAeM,IAAI,CAACE,SAApB,CAAJ,EAAoC;AAClC,aAAKT,GAAL,CAASC,KAAT,CAAeM,IAAI,CAACE,SAApB,EAA+BC,IAA/B,CAAoCF,WAApC;AACD,OAFD,MAEO;AACL,aAAKR,GAAL,CAASC,KAAT,CAAeM,IAAI,CAACE,SAApB,IAAiC,CAACD,WAAD,CAAjC;AACD;;AACD;AAVJ;;AAaA,SAAOA,WAAP;AACD,CAnBD;;AAqBAV,YAAY,CAACO,SAAb,CAAuBM,iBAAvB,GAA2C,UAAUH,WAAV,EAAuB;AAChE,UAAQ,KAAKT,QAAb;AACE,SAAK,MAAL;AAAa;;AACb,SAAK,OAAL;AAAc;;AACd,SAAK,OAAL;AAAcP,MAAAA,WAAW,CAAC,KAAKQ,GAAL,CAASC,KAAV,EAAiBO,WAAjB,CAAX;AAA0C;;AACxD,SAAK,QAAL;AACE,UAAI,KAAKR,GAAL,CAASC,KAAT,CAAeO,WAAW,CAACC,SAA3B,EAAsCG,MAAtC,KAAiD,CAArD,EAAwD;AACtD,eAAO,KAAKZ,GAAL,CAASC,KAAT,CAAeO,WAAW,CAACC,SAA3B,CAAP;AACD,OAFD,MAEO;AACLjB,QAAAA,WAAW,CAAC,KAAKQ,GAAL,CAASC,KAAT,CAAeO,WAAW,CAACC,SAA3B,CAAD,EAAwCD,WAAxC,CAAX;AACD;;AACD;AAVJ;AAYD,CAbD;;AAeAV,YAAY,CAACO,SAAb,CAAuBQ,kBAAvB,GAA4C,UAAUL,WAAV,EAAuBD,IAAvB,EAA6B;AACvE,MAAI,KAAKR,QAAL,KAAkB,OAAtB,EAA+B;AAC7B,SAAKC,GAAL,CAASO,IAAT,GAAgBA,IAAhB;AACA;AACD;;AAED,SAAOC,WAAW,CAACC,SAAnB;AACAnB,EAAAA,YAAY,CAACkB,WAAD,EAAcD,IAAd,CAAZ;AACD,CARD;;AAUAO,MAAM,CAACC,OAAP,GAAiBjB,YAAjB","sourcesContent":["var objectAssign = require('object-assign')\n\nfunction arrayRemove (arr, item) {\n  var idx = arr.indexOf(item)\n  if (~idx) arr.splice(idx, 1)\n}\n\nfunction FileAppender (strategy, req) {\n  this.strategy = strategy\n  this.req = req\n\n  switch (strategy) {\n    case 'NONE': break\n    case 'VALUE': break\n    case 'ARRAY': req.files = []; break\n    case 'OBJECT': req.files = Object.create(null); break\n    default: throw new Error('Unknown file strategy: ' + strategy)\n  }\n}\n\nFileAppender.prototype.insertPlaceholder = function (file) {\n  var placeholder = {\n    fieldname: file.fieldname\n  }\n\n  switch (this.strategy) {\n    case 'NONE': break\n    case 'VALUE': break\n    case 'ARRAY': this.req.files.push(placeholder); break\n    case 'OBJECT':\n      if (this.req.files[file.fieldname]) {\n        this.req.files[file.fieldname].push(placeholder)\n      } else {\n        this.req.files[file.fieldname] = [placeholder]\n      }\n      break\n  }\n\n  return placeholder\n}\n\nFileAppender.prototype.removePlaceholder = function (placeholder) {\n  switch (this.strategy) {\n    case 'NONE': break\n    case 'VALUE': break\n    case 'ARRAY': arrayRemove(this.req.files, placeholder); break\n    case 'OBJECT':\n      if (this.req.files[placeholder.fieldname].length === 1) {\n        delete this.req.files[placeholder.fieldname]\n      } else {\n        arrayRemove(this.req.files[placeholder.fieldname], placeholder)\n      }\n      break\n  }\n}\n\nFileAppender.prototype.replacePlaceholder = function (placeholder, file) {\n  if (this.strategy === 'VALUE') {\n    this.req.file = file\n    return\n  }\n\n  delete placeholder.fieldname\n  objectAssign(placeholder, file)\n}\n\nmodule.exports = FileAppender\n"]},"metadata":{},"sourceType":"script"}