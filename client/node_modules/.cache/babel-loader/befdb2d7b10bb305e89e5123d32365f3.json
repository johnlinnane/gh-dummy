{"ast":null,"code":"var fs = require('fs');\n\nvar os = require('os');\n\nvar path = require('path');\n\nvar crypto = require('crypto');\n\nvar mkdirp = require('mkdirp');\n\nfunction getFilename(req, file, cb) {\n  crypto.pseudoRandomBytes(16, function (err, raw) {\n    cb(err, err ? undefined : raw.toString('hex'));\n  });\n}\n\nfunction getDestination(req, file, cb) {\n  cb(null, os.tmpdir());\n}\n\nfunction DiskStorage(opts) {\n  this.getFilename = opts.filename || getFilename;\n\n  if (typeof opts.destination === 'string') {\n    mkdirp.sync(opts.destination);\n\n    this.getDestination = function ($0, $1, cb) {\n      cb(null, opts.destination);\n    };\n  } else {\n    this.getDestination = opts.destination || getDestination;\n  }\n}\n\nDiskStorage.prototype._handleFile = function _handleFile(req, file, cb) {\n  var that = this;\n  that.getDestination(req, file, function (err, destination) {\n    if (err) return cb(err);\n    that.getFilename(req, file, function (err, filename) {\n      if (err) return cb(err);\n      var finalPath = path.join(destination, filename);\n      var outStream = fs.createWriteStream(finalPath);\n      file.stream.pipe(outStream);\n      outStream.on('error', cb);\n      outStream.on('finish', function () {\n        cb(null, {\n          destination: destination,\n          filename: filename,\n          path: finalPath,\n          size: outStream.bytesWritten\n        });\n      });\n    });\n  });\n};\n\nDiskStorage.prototype._removeFile = function _removeFile(req, file, cb) {\n  var path = file.path;\n  delete file.destination;\n  delete file.filename;\n  delete file.path;\n  fs.unlink(path, cb);\n};\n\nmodule.exports = function (opts) {\n  return new DiskStorage(opts);\n};","map":{"version":3,"sources":["/Users/johnlinnane/DEV/traveller-collection/client/node_modules/multer/storage/disk.js"],"names":["fs","require","os","path","crypto","mkdirp","getFilename","req","file","cb","pseudoRandomBytes","err","raw","undefined","toString","getDestination","tmpdir","DiskStorage","opts","filename","destination","sync","$0","$1","prototype","_handleFile","that","finalPath","join","outStream","createWriteStream","stream","pipe","on","size","bytesWritten","_removeFile","unlink","module","exports"],"mappings":"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","sourcesContent":["var fs = require('fs')\nvar os = require('os')\nvar path = require('path')\nvar crypto = require('crypto')\nvar mkdirp = require('mkdirp')\n\nfunction getFilename (req, file, cb) {\n  crypto.pseudoRandomBytes(16, function (err, raw) {\n    cb(err, err ? undefined : raw.toString('hex'))\n  })\n}\n\nfunction getDestination (req, file, cb) {\n  cb(null, os.tmpdir())\n}\n\nfunction DiskStorage (opts) {\n  this.getFilename = (opts.filename || getFilename)\n\n  if (typeof opts.destination === 'string') {\n    mkdirp.sync(opts.destination)\n    this.getDestination = function ($0, $1, cb) { cb(null, opts.destination) }\n  } else {\n    this.getDestination = (opts.destination || getDestination)\n  }\n}\n\nDiskStorage.prototype._handleFile = function _handleFile (req, file, cb) {\n  var that = this\n\n  that.getDestination(req, file, function (err, destination) {\n    if (err) return cb(err)\n\n    that.getFilename(req, file, function (err, filename) {\n      if (err) return cb(err)\n\n      var finalPath = path.join(destination, filename)\n      var outStream = fs.createWriteStream(finalPath)\n\n      file.stream.pipe(outStream)\n      outStream.on('error', cb)\n      outStream.on('finish', function () {\n        cb(null, {\n          destination: destination,\n          filename: filename,\n          path: finalPath,\n          size: outStream.bytesWritten\n        })\n      })\n    })\n  })\n}\n\nDiskStorage.prototype._removeFile = function _removeFile (req, file, cb) {\n  var path = file.path\n\n  delete file.destination\n  delete file.filename\n  delete file.path\n\n  fs.unlink(path, cb)\n}\n\nmodule.exports = function (opts) {\n  return new DiskStorage(opts)\n}\n"]},"metadata":{},"sourceType":"script"}