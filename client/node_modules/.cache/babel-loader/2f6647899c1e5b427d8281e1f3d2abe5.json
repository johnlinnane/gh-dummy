{"ast":null,"code":"var makeMiddleware = require('./lib/make-middleware');\n\nvar diskStorage = require('./storage/disk');\n\nvar memoryStorage = require('./storage/memory');\n\nvar MulterError = require('./lib/multer-error');\n\nfunction allowAll(req, file, cb) {\n  cb(null, true);\n}\n\nfunction Multer(options) {\n  if (options.storage) {\n    this.storage = options.storage;\n  } else if (options.dest) {\n    this.storage = diskStorage({\n      destination: options.dest\n    });\n  } else {\n    this.storage = memoryStorage();\n  }\n\n  this.limits = options.limits;\n  this.preservePath = options.preservePath;\n  this.fileFilter = options.fileFilter || allowAll;\n}\n\nMulter.prototype._makeMiddleware = function (fields, fileStrategy) {\n  function setup() {\n    var fileFilter = this.fileFilter;\n    var filesLeft = Object.create(null);\n    fields.forEach(function (field) {\n      if (typeof field.maxCount === 'number') {\n        filesLeft[field.name] = field.maxCount;\n      } else {\n        filesLeft[field.name] = Infinity;\n      }\n    });\n\n    function wrappedFileFilter(req, file, cb) {\n      if ((filesLeft[file.fieldname] || 0) <= 0) {\n        return cb(new MulterError('LIMIT_UNEXPECTED_FILE', file.fieldname));\n      }\n\n      filesLeft[file.fieldname] -= 1;\n      fileFilter(req, file, cb);\n    }\n\n    return {\n      limits: this.limits,\n      preservePath: this.preservePath,\n      storage: this.storage,\n      fileFilter: wrappedFileFilter,\n      fileStrategy: fileStrategy\n    };\n  }\n\n  return makeMiddleware(setup.bind(this));\n};\n\nMulter.prototype.single = function (name) {\n  return this._makeMiddleware([{\n    name: name,\n    maxCount: 1\n  }], 'VALUE');\n};\n\nMulter.prototype.array = function (name, maxCount) {\n  return this._makeMiddleware([{\n    name: name,\n    maxCount: maxCount\n  }], 'ARRAY');\n};\n\nMulter.prototype.fields = function (fields) {\n  return this._makeMiddleware(fields, 'OBJECT');\n};\n\nMulter.prototype.none = function () {\n  return this._makeMiddleware([], 'NONE');\n};\n\nMulter.prototype.any = function () {\n  function setup() {\n    return {\n      limits: this.limits,\n      preservePath: this.preservePath,\n      storage: this.storage,\n      fileFilter: this.fileFilter,\n      fileStrategy: 'ARRAY'\n    };\n  }\n\n  return makeMiddleware(setup.bind(this));\n};\n\nfunction multer(options) {\n  if (options === undefined) {\n    return new Multer({});\n  }\n\n  if (typeof options === 'object' && options !== null) {\n    return new Multer(options);\n  }\n\n  throw new TypeError('Expected object for argument options');\n}\n\nmodule.exports = multer;\nmodule.exports.diskStorage = diskStorage;\nmodule.exports.memoryStorage = memoryStorage;\nmodule.exports.MulterError = MulterError;","map":{"version":3,"sources":["/Users/johnlinnane/DEV/traveller-collection/client/node_modules/multer/index.js"],"names":["makeMiddleware","require","diskStorage","memoryStorage","MulterError","allowAll","req","file","cb","Multer","options","storage","dest","destination","limits","preservePath","fileFilter","prototype","_makeMiddleware","fields","fileStrategy","setup","filesLeft","Object","create","forEach","field","maxCount","name","Infinity","wrappedFileFilter","fieldname","bind","single","array","none","any","multer","undefined","TypeError","module","exports"],"mappings":"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","sourcesContent":["var makeMiddleware = require('./lib/make-middleware')\n\nvar diskStorage = require('./storage/disk')\nvar memoryStorage = require('./storage/memory')\nvar MulterError = require('./lib/multer-error')\n\nfunction allowAll (req, file, cb) {\n  cb(null, true)\n}\n\nfunction Multer (options) {\n  if (options.storage) {\n    this.storage = options.storage\n  } else if (options.dest) {\n    this.storage = diskStorage({ destination: options.dest })\n  } else {\n    this.storage = memoryStorage()\n  }\n\n  this.limits = options.limits\n  this.preservePath = options.preservePath\n  this.fileFilter = options.fileFilter || allowAll\n}\n\nMulter.prototype._makeMiddleware = function (fields, fileStrategy) {\n  function setup () {\n    var fileFilter = this.fileFilter\n    var filesLeft = Object.create(null)\n\n    fields.forEach(function (field) {\n      if (typeof field.maxCount === 'number') {\n        filesLeft[field.name] = field.maxCount\n      } else {\n        filesLeft[field.name] = Infinity\n      }\n    })\n\n    function wrappedFileFilter (req, file, cb) {\n      if ((filesLeft[file.fieldname] || 0) <= 0) {\n        return cb(new MulterError('LIMIT_UNEXPECTED_FILE', file.fieldname))\n      }\n\n      filesLeft[file.fieldname] -= 1\n      fileFilter(req, file, cb)\n    }\n\n    return {\n      limits: this.limits,\n      preservePath: this.preservePath,\n      storage: this.storage,\n      fileFilter: wrappedFileFilter,\n      fileStrategy: fileStrategy\n    }\n  }\n\n  return makeMiddleware(setup.bind(this))\n}\n\nMulter.prototype.single = function (name) {\n  return this._makeMiddleware([{ name: name, maxCount: 1 }], 'VALUE')\n}\n\nMulter.prototype.array = function (name, maxCount) {\n  return this._makeMiddleware([{ name: name, maxCount: maxCount }], 'ARRAY')\n}\n\nMulter.prototype.fields = function (fields) {\n  return this._makeMiddleware(fields, 'OBJECT')\n}\n\nMulter.prototype.none = function () {\n  return this._makeMiddleware([], 'NONE')\n}\n\nMulter.prototype.any = function () {\n  function setup () {\n    return {\n      limits: this.limits,\n      preservePath: this.preservePath,\n      storage: this.storage,\n      fileFilter: this.fileFilter,\n      fileStrategy: 'ARRAY'\n    }\n  }\n\n  return makeMiddleware(setup.bind(this))\n}\n\nfunction multer (options) {\n  if (options === undefined) {\n    return new Multer({})\n  }\n\n  if (typeof options === 'object' && options !== null) {\n    return new Multer(options)\n  }\n\n  throw new TypeError('Expected object for argument options')\n}\n\nmodule.exports = multer\nmodule.exports.diskStorage = diskStorage\nmodule.exports.memoryStorage = memoryStorage\nmodule.exports.MulterError = MulterError\n"]},"metadata":{},"sourceType":"script"}