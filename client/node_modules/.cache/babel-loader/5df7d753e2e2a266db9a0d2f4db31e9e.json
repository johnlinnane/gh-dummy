{"ast":null,"code":"function valueType(value) {\n  if (value === undefined) return 'undefined';\n  if (Array.isArray(value)) return 'array';\n  if (typeof value === 'object') return 'object';\n  return 'scalar';\n}\n\nfunction setLastValue(context, step, currentValue, entryValue) {\n  switch (valueType(currentValue)) {\n    case 'undefined':\n      if (step.append) {\n        context[step.key] = [entryValue];\n      } else {\n        context[step.key] = entryValue;\n      }\n\n      break;\n\n    case 'array':\n      context[step.key].push(entryValue);\n      break;\n\n    case 'object':\n      return setLastValue(currentValue, {\n        type: 'object',\n        key: '',\n        last: true\n      }, currentValue[''], entryValue);\n\n    case 'scalar':\n      context[step.key] = [context[step.key], entryValue];\n      break;\n  }\n\n  return context;\n}\n\nfunction setValue(context, step, currentValue, entryValue) {\n  if (step.last) return setLastValue(context, step, currentValue, entryValue);\n  var obj;\n\n  switch (valueType(currentValue)) {\n    case 'undefined':\n      if (step.nextType === 'array') {\n        context[step.key] = [];\n      } else {\n        context[step.key] = Object.create(null);\n      }\n\n      return context[step.key];\n\n    case 'object':\n      return context[step.key];\n\n    case 'array':\n      if (step.nextType === 'array') {\n        return currentValue;\n      }\n\n      obj = Object.create(null);\n      context[step.key] = obj;\n      currentValue.forEach(function (item, i) {\n        if (item !== undefined) obj['' + i] = item;\n      });\n      return obj;\n\n    case 'scalar':\n      obj = Object.create(null);\n      obj[''] = currentValue;\n      context[step.key] = obj;\n      return obj;\n  }\n}\n\nmodule.exports = setValue;","map":{"version":3,"sources":["/Users/johnlinnane/DEV/traveller-collection/client/node_modules/append-field/lib/set-value.js"],"names":["valueType","value","undefined","Array","isArray","setLastValue","context","step","currentValue","entryValue","append","key","push","type","last","setValue","obj","nextType","Object","create","forEach","item","i","module","exports"],"mappings":"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","sourcesContent":["function valueType (value) {\n  if (value === undefined) return 'undefined'\n  if (Array.isArray(value)) return 'array'\n  if (typeof value === 'object') return 'object'\n  return 'scalar'\n}\n\nfunction setLastValue (context, step, currentValue, entryValue) {\n  switch (valueType(currentValue)) {\n    case 'undefined':\n      if (step.append) {\n        context[step.key] = [entryValue]\n      } else {\n        context[step.key] = entryValue\n      }\n      break\n    case 'array':\n      context[step.key].push(entryValue)\n      break\n    case 'object':\n      return setLastValue(currentValue, { type: 'object', key: '', last: true }, currentValue[''], entryValue)\n    case 'scalar':\n      context[step.key] = [context[step.key], entryValue]\n      break\n  }\n\n  return context\n}\n\nfunction setValue (context, step, currentValue, entryValue) {\n  if (step.last) return setLastValue(context, step, currentValue, entryValue)\n\n  var obj\n  switch (valueType(currentValue)) {\n    case 'undefined':\n      if (step.nextType === 'array') {\n        context[step.key] = []\n      } else {\n        context[step.key] = Object.create(null)\n      }\n      return context[step.key]\n    case 'object':\n      return context[step.key]\n    case 'array':\n      if (step.nextType === 'array') {\n        return currentValue\n      }\n\n      obj = Object.create(null)\n      context[step.key] = obj\n      currentValue.forEach(function (item, i) {\n        if (item !== undefined) obj['' + i] = item\n      })\n\n      return obj\n    case 'scalar':\n      obj = Object.create(null)\n      obj[''] = currentValue\n      context[step.key] = obj\n      return obj\n  }\n}\n\nmodule.exports = setValue\n"]},"metadata":{},"sourceType":"script"}